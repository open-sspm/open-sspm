// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: normalized_datasets.sql

package gen

import (
	"context"
)

const listNormalizedEntitlementAssignments = `-- name: ListNormalizedEntitlementAssignments :many
SELECT
  e.id AS entitlement_id,
  iu.id AS idp_user_id,
  iu.email AS idp_user_email,
  iu.display_name AS idp_user_display_name,
  iu.status AS idp_user_status,
  au.source_kind AS source_kind,
  au.source_name AS source_name,
  au.external_id AS app_user_external_id,
  e.kind AS entitlement_kind,
  e.resource AS entitlement_resource,
  e.permission AS entitlement_permission
FROM entitlements e
JOIN app_users au ON au.id = e.app_user_id
JOIN identity_links il ON il.app_user_id = au.id
JOIN idp_users iu ON iu.id = il.idp_user_id
WHERE
  e.expired_at IS NULL
  AND e.last_observed_run_id IS NOT NULL
  AND au.expired_at IS NULL
  AND au.last_observed_run_id IS NOT NULL
  AND iu.expired_at IS NULL
  AND iu.last_observed_run_id IS NOT NULL
ORDER BY iu.id, au.id, e.id
`

type ListNormalizedEntitlementAssignmentsRow struct {
	EntitlementID         int64  `json:"entitlement_id"`
	IdpUserID             int64  `json:"idp_user_id"`
	IdpUserEmail          string `json:"idp_user_email"`
	IdpUserDisplayName    string `json:"idp_user_display_name"`
	IdpUserStatus         string `json:"idp_user_status"`
	SourceKind            string `json:"source_kind"`
	SourceName            string `json:"source_name"`
	AppUserExternalID     string `json:"app_user_external_id"`
	EntitlementKind       string `json:"entitlement_kind"`
	EntitlementResource   string `json:"entitlement_resource"`
	EntitlementPermission string `json:"entitlement_permission"`
}

func (q *Queries) ListNormalizedEntitlementAssignments(ctx context.Context) ([]ListNormalizedEntitlementAssignmentsRow, error) {
	rows, err := q.db.Query(ctx, listNormalizedEntitlementAssignments)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []ListNormalizedEntitlementAssignmentsRow
	for rows.Next() {
		var i ListNormalizedEntitlementAssignmentsRow
		if err := rows.Scan(
			&i.EntitlementID,
			&i.IdpUserID,
			&i.IdpUserEmail,
			&i.IdpUserDisplayName,
			&i.IdpUserStatus,
			&i.SourceKind,
			&i.SourceName,
			&i.AppUserExternalID,
			&i.EntitlementKind,
			&i.EntitlementResource,
			&i.EntitlementPermission,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}
