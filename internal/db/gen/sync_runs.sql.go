// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: sync_runs.sql

package gen

import (
	"context"
)

const acquireAdvisoryLock = `-- name: AcquireAdvisoryLock :exec
SELECT pg_advisory_lock($1::bigint)
`

func (q *Queries) AcquireAdvisoryLock(ctx context.Context, dollar_1 int64) error {
	_, err := q.db.Exec(ctx, acquireAdvisoryLock, dollar_1)
	return err
}

const createSyncRun = `-- name: CreateSyncRun :one
INSERT INTO sync_runs (source_kind, source_name, status, started_at)
VALUES ($1, $2, 'running', now())
RETURNING id
`

type CreateSyncRunParams struct {
	SourceKind string `json:"source_kind"`
	SourceName string `json:"source_name"`
}

func (q *Queries) CreateSyncRun(ctx context.Context, arg CreateSyncRunParams) (int64, error) {
	row := q.db.QueryRow(ctx, createSyncRun, arg.SourceKind, arg.SourceName)
	var id int64
	err := row.Scan(&id)
	return id, err
}

const failSyncRun = `-- name: FailSyncRun :exec
UPDATE sync_runs
SET status = $2, finished_at = now(), message = $3, error_kind = $4
WHERE id = $1
`

type FailSyncRunParams struct {
	ID        int64  `json:"id"`
	Status    string `json:"status"`
	Message   string `json:"message"`
	ErrorKind string `json:"error_kind"`
}

func (q *Queries) FailSyncRun(ctx context.Context, arg FailSyncRunParams) error {
	_, err := q.db.Exec(ctx, failSyncRun,
		arg.ID,
		arg.Status,
		arg.Message,
		arg.ErrorKind,
	)
	return err
}

const markSyncRunSuccess = `-- name: MarkSyncRunSuccess :exec
UPDATE sync_runs
SET status = 'success', finished_at = now(), message = '', stats = $2, error_kind = ''
WHERE id = $1
`

type MarkSyncRunSuccessParams struct {
	ID    int64  `json:"id"`
	Stats []byte `json:"stats"`
}

func (q *Queries) MarkSyncRunSuccess(ctx context.Context, arg MarkSyncRunSuccessParams) error {
	_, err := q.db.Exec(ctx, markSyncRunSuccess, arg.ID, arg.Stats)
	return err
}

const releaseAdvisoryLock = `-- name: ReleaseAdvisoryLock :exec
SELECT pg_advisory_unlock($1::bigint)
`

func (q *Queries) ReleaseAdvisoryLock(ctx context.Context, dollar_1 int64) error {
	_, err := q.db.Exec(ctx, releaseAdvisoryLock, dollar_1)
	return err
}
