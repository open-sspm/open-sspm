// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: saas_app_governance.sql

package gen

import (
	"context"

	"github.com/jackc/pgx/v5/pgtype"
)

const getSaaSAppGovernanceViewBySaaSAppID = `-- name: GetSaaSAppGovernanceViewBySaaSAppID :one
SELECT
  sa.id AS saas_app_id,
  go.owner_identity_id,
  COALESCE(go.business_criticality, 'unknown') AS business_criticality,
  COALESCE(go.data_classification, 'unknown') AS data_classification,
  COALESCE(go.notes, '') AS notes,
  go.updated_by_auth_user_id,
  go.updated_at,
  COALESCE(owner.display_name, '') AS owner_display_name,
  COALESCE(owner.primary_email, '') AS owner_primary_email
FROM saas_apps sa
LEFT JOIN saas_app_governance_overrides go ON go.saas_app_id = sa.id
LEFT JOIN identities owner ON owner.id = go.owner_identity_id
WHERE sa.id = $1
`

type GetSaaSAppGovernanceViewBySaaSAppIDRow struct {
	SaasAppID           int64              `json:"saas_app_id"`
	OwnerIdentityID     pgtype.Int8        `json:"owner_identity_id"`
	BusinessCriticality string             `json:"business_criticality"`
	DataClassification  string             `json:"data_classification"`
	Notes               string             `json:"notes"`
	UpdatedByAuthUserID pgtype.Int8        `json:"updated_by_auth_user_id"`
	UpdatedAt           pgtype.Timestamptz `json:"updated_at"`
	OwnerDisplayName    string             `json:"owner_display_name"`
	OwnerPrimaryEmail   string             `json:"owner_primary_email"`
}

func (q *Queries) GetSaaSAppGovernanceViewBySaaSAppID(ctx context.Context, id int64) (GetSaaSAppGovernanceViewBySaaSAppIDRow, error) {
	row := q.db.QueryRow(ctx, getSaaSAppGovernanceViewBySaaSAppID, id)
	var i GetSaaSAppGovernanceViewBySaaSAppIDRow
	err := row.Scan(
		&i.SaasAppID,
		&i.OwnerIdentityID,
		&i.BusinessCriticality,
		&i.DataClassification,
		&i.Notes,
		&i.UpdatedByAuthUserID,
		&i.UpdatedAt,
		&i.OwnerDisplayName,
		&i.OwnerPrimaryEmail,
	)
	return i, err
}

const upsertSaaSAppGovernanceOverride = `-- name: UpsertSaaSAppGovernanceOverride :exec
INSERT INTO saas_app_governance_overrides (
  saas_app_id,
  owner_identity_id,
  business_criticality,
  data_classification,
  notes,
  updated_by_auth_user_id,
  updated_at
)
VALUES (
  $1::bigint,
  $2::bigint,
  $3::text,
  $4::text,
  $5::text,
  $6::bigint,
  now()
)
ON CONFLICT (saas_app_id) DO UPDATE SET
  owner_identity_id = EXCLUDED.owner_identity_id,
  business_criticality = EXCLUDED.business_criticality,
  data_classification = EXCLUDED.data_classification,
  notes = EXCLUDED.notes,
  updated_by_auth_user_id = EXCLUDED.updated_by_auth_user_id,
  updated_at = now()
`

type UpsertSaaSAppGovernanceOverrideParams struct {
	SaasAppID           int64       `json:"saas_app_id"`
	OwnerIdentityID     pgtype.Int8 `json:"owner_identity_id"`
	BusinessCriticality string      `json:"business_criticality"`
	DataClassification  string      `json:"data_classification"`
	Notes               string      `json:"notes"`
	UpdatedByAuthUserID pgtype.Int8 `json:"updated_by_auth_user_id"`
}

func (q *Queries) UpsertSaaSAppGovernanceOverride(ctx context.Context, arg UpsertSaaSAppGovernanceOverrideParams) error {
	_, err := q.db.Exec(ctx, upsertSaaSAppGovernanceOverride,
		arg.SaasAppID,
		arg.OwnerIdentityID,
		arg.BusinessCriticality,
		arg.DataClassification,
		arg.Notes,
		arg.UpdatedByAuthUserID,
	)
	return err
}
