// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: freshness.sql

package gen

import (
	"context"

	"github.com/jackc/pgx/v5/pgtype"
)

const expireAppUsersNotSeenInRun = `-- name: ExpireAppUsersNotSeenInRun :execrows
UPDATE app_users
SET
  expired_at = now(),
  expired_run_id = $1
WHERE source_kind = $2
  AND source_name = $3
  AND expired_at IS NULL
  AND last_observed_run_id IS NOT NULL
  AND (seen_in_run_id <> $1 OR seen_in_run_id IS NULL)
`

type ExpireAppUsersNotSeenInRunParams struct {
	ExpiredRunID pgtype.Int8 `json:"expired_run_id"`
	SourceKind   string      `json:"source_kind"`
	SourceName   string      `json:"source_name"`
}

func (q *Queries) ExpireAppUsersNotSeenInRun(ctx context.Context, arg ExpireAppUsersNotSeenInRunParams) (int64, error) {
	result, err := q.db.Exec(ctx, expireAppUsersNotSeenInRun, arg.ExpiredRunID, arg.SourceKind, arg.SourceName)
	if err != nil {
		return 0, err
	}
	return result.RowsAffected(), nil
}

const expireEntitlementsNotSeenInRunBySource = `-- name: ExpireEntitlementsNotSeenInRunBySource :execrows
UPDATE entitlements e
SET
  expired_at = now(),
  expired_run_id = $1
FROM app_users au
WHERE au.id = e.app_user_id
  AND au.source_kind = $2
  AND au.source_name = $3
  AND e.expired_at IS NULL
  AND e.last_observed_run_id IS NOT NULL
  AND (e.seen_in_run_id <> $1 OR e.seen_in_run_id IS NULL)
`

type ExpireEntitlementsNotSeenInRunBySourceParams struct {
	ExpiredRunID pgtype.Int8 `json:"expired_run_id"`
	SourceKind   string      `json:"source_kind"`
	SourceName   string      `json:"source_name"`
}

func (q *Queries) ExpireEntitlementsNotSeenInRunBySource(ctx context.Context, arg ExpireEntitlementsNotSeenInRunBySourceParams) (int64, error) {
	result, err := q.db.Exec(ctx, expireEntitlementsNotSeenInRunBySource, arg.ExpiredRunID, arg.SourceKind, arg.SourceName)
	if err != nil {
		return 0, err
	}
	return result.RowsAffected(), nil
}

const expireIdPUsersNotSeenInRun = `-- name: ExpireIdPUsersNotSeenInRun :execrows
UPDATE idp_users
SET
  expired_at = now(),
  expired_run_id = $1
WHERE expired_at IS NULL
  AND last_observed_run_id IS NOT NULL
  AND (seen_in_run_id <> $1 OR seen_in_run_id IS NULL)
`

func (q *Queries) ExpireIdPUsersNotSeenInRun(ctx context.Context, expiredRunID pgtype.Int8) (int64, error) {
	result, err := q.db.Exec(ctx, expireIdPUsersNotSeenInRun, expiredRunID)
	if err != nil {
		return 0, err
	}
	return result.RowsAffected(), nil
}

const expireOktaAppGroupAssignmentsNotSeenInRun = `-- name: ExpireOktaAppGroupAssignmentsNotSeenInRun :execrows
UPDATE okta_app_group_assignments
SET
  expired_at = now(),
  expired_run_id = $1
WHERE expired_at IS NULL
  AND last_observed_run_id IS NOT NULL
  AND (seen_in_run_id <> $1 OR seen_in_run_id IS NULL)
`

func (q *Queries) ExpireOktaAppGroupAssignmentsNotSeenInRun(ctx context.Context, expiredRunID pgtype.Int8) (int64, error) {
	result, err := q.db.Exec(ctx, expireOktaAppGroupAssignmentsNotSeenInRun, expiredRunID)
	if err != nil {
		return 0, err
	}
	return result.RowsAffected(), nil
}

const expireOktaAppsNotSeenInRun = `-- name: ExpireOktaAppsNotSeenInRun :execrows
UPDATE okta_apps
SET
  expired_at = now(),
  expired_run_id = $1
WHERE expired_at IS NULL
  AND last_observed_run_id IS NOT NULL
  AND (seen_in_run_id <> $1 OR seen_in_run_id IS NULL)
`

func (q *Queries) ExpireOktaAppsNotSeenInRun(ctx context.Context, expiredRunID pgtype.Int8) (int64, error) {
	result, err := q.db.Exec(ctx, expireOktaAppsNotSeenInRun, expiredRunID)
	if err != nil {
		return 0, err
	}
	return result.RowsAffected(), nil
}

const expireOktaGroupsNotSeenInRun = `-- name: ExpireOktaGroupsNotSeenInRun :execrows
UPDATE okta_groups
SET
  expired_at = now(),
  expired_run_id = $1
WHERE expired_at IS NULL
  AND last_observed_run_id IS NOT NULL
  AND (seen_in_run_id <> $1 OR seen_in_run_id IS NULL)
`

func (q *Queries) ExpireOktaGroupsNotSeenInRun(ctx context.Context, expiredRunID pgtype.Int8) (int64, error) {
	result, err := q.db.Exec(ctx, expireOktaGroupsNotSeenInRun, expiredRunID)
	if err != nil {
		return 0, err
	}
	return result.RowsAffected(), nil
}

const expireOktaUserAppAssignmentsNotSeenInRun = `-- name: ExpireOktaUserAppAssignmentsNotSeenInRun :execrows
UPDATE okta_user_app_assignments
SET
  expired_at = now(),
  expired_run_id = $1
WHERE expired_at IS NULL
  AND last_observed_run_id IS NOT NULL
  AND (seen_in_run_id <> $1 OR seen_in_run_id IS NULL)
`

func (q *Queries) ExpireOktaUserAppAssignmentsNotSeenInRun(ctx context.Context, expiredRunID pgtype.Int8) (int64, error) {
	result, err := q.db.Exec(ctx, expireOktaUserAppAssignmentsNotSeenInRun, expiredRunID)
	if err != nil {
		return 0, err
	}
	return result.RowsAffected(), nil
}

const expireOktaUserGroupsNotSeenInRun = `-- name: ExpireOktaUserGroupsNotSeenInRun :execrows
UPDATE okta_user_groups
SET
  expired_at = now(),
  expired_run_id = $1
WHERE expired_at IS NULL
  AND last_observed_run_id IS NOT NULL
  AND (seen_in_run_id <> $1 OR seen_in_run_id IS NULL)
`

func (q *Queries) ExpireOktaUserGroupsNotSeenInRun(ctx context.Context, expiredRunID pgtype.Int8) (int64, error) {
	result, err := q.db.Exec(ctx, expireOktaUserGroupsNotSeenInRun, expiredRunID)
	if err != nil {
		return 0, err
	}
	return result.RowsAffected(), nil
}

const promoteAppUsersSeenInRun = `-- name: PromoteAppUsersSeenInRun :execrows
UPDATE app_users
SET
  last_observed_run_id = $1,
  last_observed_at = now(),
  expired_at = NULL,
  expired_run_id = NULL
WHERE source_kind = $2
  AND source_name = $3
  AND seen_in_run_id = $1
`

type PromoteAppUsersSeenInRunParams struct {
	LastObservedRunID pgtype.Int8 `json:"last_observed_run_id"`
	SourceKind        string      `json:"source_kind"`
	SourceName        string      `json:"source_name"`
}

func (q *Queries) PromoteAppUsersSeenInRun(ctx context.Context, arg PromoteAppUsersSeenInRunParams) (int64, error) {
	result, err := q.db.Exec(ctx, promoteAppUsersSeenInRun, arg.LastObservedRunID, arg.SourceKind, arg.SourceName)
	if err != nil {
		return 0, err
	}
	return result.RowsAffected(), nil
}

const promoteEntitlementsSeenInRunBySource = `-- name: PromoteEntitlementsSeenInRunBySource :execrows
UPDATE entitlements e
SET
  last_observed_run_id = $1,
  last_observed_at = now(),
  expired_at = NULL,
  expired_run_id = NULL
FROM app_users au
WHERE au.id = e.app_user_id
  AND au.source_kind = $2
  AND au.source_name = $3
  AND e.seen_in_run_id = $1
`

type PromoteEntitlementsSeenInRunBySourceParams struct {
	LastObservedRunID pgtype.Int8 `json:"last_observed_run_id"`
	SourceKind        string      `json:"source_kind"`
	SourceName        string      `json:"source_name"`
}

func (q *Queries) PromoteEntitlementsSeenInRunBySource(ctx context.Context, arg PromoteEntitlementsSeenInRunBySourceParams) (int64, error) {
	result, err := q.db.Exec(ctx, promoteEntitlementsSeenInRunBySource, arg.LastObservedRunID, arg.SourceKind, arg.SourceName)
	if err != nil {
		return 0, err
	}
	return result.RowsAffected(), nil
}

const promoteIdPUsersSeenInRun = `-- name: PromoteIdPUsersSeenInRun :execrows
UPDATE idp_users
SET
  last_observed_run_id = $1,
  last_observed_at = now(),
  expired_at = NULL,
  expired_run_id = NULL
WHERE seen_in_run_id = $1
`

func (q *Queries) PromoteIdPUsersSeenInRun(ctx context.Context, lastObservedRunID pgtype.Int8) (int64, error) {
	result, err := q.db.Exec(ctx, promoteIdPUsersSeenInRun, lastObservedRunID)
	if err != nil {
		return 0, err
	}
	return result.RowsAffected(), nil
}

const promoteOktaAppGroupAssignmentsSeenInRun = `-- name: PromoteOktaAppGroupAssignmentsSeenInRun :execrows
UPDATE okta_app_group_assignments
SET
  last_observed_run_id = $1,
  last_observed_at = now(),
  expired_at = NULL,
  expired_run_id = NULL
WHERE seen_in_run_id = $1
`

func (q *Queries) PromoteOktaAppGroupAssignmentsSeenInRun(ctx context.Context, lastObservedRunID pgtype.Int8) (int64, error) {
	result, err := q.db.Exec(ctx, promoteOktaAppGroupAssignmentsSeenInRun, lastObservedRunID)
	if err != nil {
		return 0, err
	}
	return result.RowsAffected(), nil
}

const promoteOktaAppsSeenInRun = `-- name: PromoteOktaAppsSeenInRun :execrows
UPDATE okta_apps
SET
  last_observed_run_id = $1,
  last_observed_at = now(),
  expired_at = NULL,
  expired_run_id = NULL
WHERE seen_in_run_id = $1
`

func (q *Queries) PromoteOktaAppsSeenInRun(ctx context.Context, lastObservedRunID pgtype.Int8) (int64, error) {
	result, err := q.db.Exec(ctx, promoteOktaAppsSeenInRun, lastObservedRunID)
	if err != nil {
		return 0, err
	}
	return result.RowsAffected(), nil
}

const promoteOktaGroupsSeenInRun = `-- name: PromoteOktaGroupsSeenInRun :execrows
UPDATE okta_groups
SET
  last_observed_run_id = $1,
  last_observed_at = now(),
  expired_at = NULL,
  expired_run_id = NULL
WHERE seen_in_run_id = $1
`

func (q *Queries) PromoteOktaGroupsSeenInRun(ctx context.Context, lastObservedRunID pgtype.Int8) (int64, error) {
	result, err := q.db.Exec(ctx, promoteOktaGroupsSeenInRun, lastObservedRunID)
	if err != nil {
		return 0, err
	}
	return result.RowsAffected(), nil
}

const promoteOktaUserAppAssignmentsSeenInRun = `-- name: PromoteOktaUserAppAssignmentsSeenInRun :execrows
UPDATE okta_user_app_assignments
SET
  last_observed_run_id = $1,
  last_observed_at = now(),
  expired_at = NULL,
  expired_run_id = NULL
WHERE seen_in_run_id = $1
`

func (q *Queries) PromoteOktaUserAppAssignmentsSeenInRun(ctx context.Context, lastObservedRunID pgtype.Int8) (int64, error) {
	result, err := q.db.Exec(ctx, promoteOktaUserAppAssignmentsSeenInRun, lastObservedRunID)
	if err != nil {
		return 0, err
	}
	return result.RowsAffected(), nil
}

const promoteOktaUserGroupsSeenInRun = `-- name: PromoteOktaUserGroupsSeenInRun :execrows
UPDATE okta_user_groups
SET
  last_observed_run_id = $1,
  last_observed_at = now(),
  expired_at = NULL,
  expired_run_id = NULL
WHERE seen_in_run_id = $1
`

func (q *Queries) PromoteOktaUserGroupsSeenInRun(ctx context.Context, lastObservedRunID pgtype.Int8) (int64, error) {
	result, err := q.db.Exec(ctx, promoteOktaUserGroupsSeenInRun, lastObservedRunID)
	if err != nil {
		return 0, err
	}
	return result.RowsAffected(), nil
}
